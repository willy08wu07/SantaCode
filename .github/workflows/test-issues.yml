name: Test Multi-language Issue

on:
  workflow_dispatch:

jobs:
  test-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Create Test Announcement Issue (Multi-language)
        uses: actions/github-script@v7
        with:
          script: |
            const participantCount = 5; // Test data
            const runUrl = `https://github.com/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId}`;
            const year = new Date().getFullYear();
            const exchangeDate = new Date().toISOString().split('T')[0];
            const bold = '**';
            const codeBlock = '```';

            // Build multi-language issue body with collapsible sections
            const issueBody = [
              '# [TEST] ğŸ„ SantaCode Exchange Completed! | äº¤æ›å®Œæˆï¼ | äº¤æ›å®Œäº†ï¼ğŸ',
              '',
              '> ğŸŒ Choose your language below | åœ¨ä¸‹æ–¹é¸æ“‡ä½ çš„èªè¨€ | ä»¥ä¸‹ã‹ã‚‰è¨€èªã‚’é¸æŠã—ã¦ãã ã•ã„',
              '',
              '> âš ï¸ This is a TEST issue. Real announcements will not have [TEST] prefix.',
              '',
              '---',
              '',
              '<details open>',
              '<summary><h2>ğŸ‡¬ğŸ‡§ English Version (Test)</h2></summary>',
              '',
              '## Test Exchange Results',
              '',
              `This is a ${bold}test${bold} of the multi-language announcement system.`,
              '',
              '### ğŸ“Š Test Statistics',
              `- ${bold}Participants${bold}: ${participantCount} (test data)`,
              `- ${bold}Exchange Date${bold}: ${exchangeDate}`,
              `- ${bold}Status${bold}: âœ… Testing`,
              '',
              '### âœ… What Was Tested',
              '',
              '- Collapsible sections work correctly',
              '- Multiple languages in one issue',
              '- Only ONE notification sent to watchers',
              '- Markdown formatting renders properly',
              '',
              `ğŸŒŸ ${bold}Test completed successfully!${bold} ğŸŒŸ`,
              '',
              '</details>',
              '',
              '---',
              '',
              '<details>',
              '<summary><h2>ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡ç‰ˆæœ¬ï¼ˆæ¸¬è©¦ï¼‰</h2></summary>',
              '',
              '## æ¸¬è©¦äº¤æ›çµæœ',
              '',
              `é€™æ˜¯å¤šèªè¨€å…¬å‘Šç³»çµ±çš„${bold}æ¸¬è©¦${bold}ã€‚`,
              '',
              '### ğŸ“Š æ¸¬è©¦çµ±è¨ˆ',
              `- ${bold}åƒèˆ‡äººæ•¸${bold}: ${participantCount}ï¼ˆæ¸¬è©¦è³‡æ–™ï¼‰`,
              `- ${bold}äº¤æ›æ—¥æœŸ${bold}: ${exchangeDate}`,
              `- ${bold}ç‹€æ…‹${bold}: âœ… æ¸¬è©¦ä¸­`,
              '',
              '### âœ… æ¸¬è©¦é …ç›®',
              '',
              '- æŠ˜ç–Šå€å¡Šæ­£å¸¸é‹ä½œ',
              '- å–®ä¸€ Issue åŒ…å«å¤šç¨®èªè¨€',
              '- åªç™¼é€ä¸€å€‹é€šçŸ¥çµ¦è¨‚é–±è€…',
              '- Markdown æ ¼å¼æ­£ç¢ºå‘ˆç¾',
              '',
              `ğŸŒŸ ${bold}æ¸¬è©¦æˆåŠŸå®Œæˆï¼${bold} ğŸŒŸ`,
              '',
              '</details>',
              '',
              '---',
              '',
              '<details>',
              '<summary><h2>ğŸ‡¯ğŸ‡µ æ—¥æœ¬èªç‰ˆï¼ˆãƒ†ã‚¹ãƒˆï¼‰</h2></summary>',
              '',
              '## ãƒ†ã‚¹ãƒˆäº¤æ›çµæœ',
              '',
              `ã“ã‚Œã¯å¤šè¨€èªã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã‚·ã‚¹ãƒ†ãƒ ã®${bold}ãƒ†ã‚¹ãƒˆ${bold}ã§ã™ã€‚`,
              '',
              '### ğŸ“Š ãƒ†ã‚¹ãƒˆçµ±è¨ˆ',
              `- ${bold}å‚åŠ è€…æ•°${bold}: ${participantCount}ï¼ˆãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼‰`,
              `- ${bold}äº¤æ›æ—¥${bold}: ${exchangeDate}`,
              `- ${bold}ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹${bold}: âœ… ãƒ†ã‚¹ãƒˆä¸­`,
              '',
              '### âœ… ãƒ†ã‚¹ãƒˆé …ç›®',
              '',
              '- æŠ˜ã‚ŠãŸãŸã¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«æ©Ÿèƒ½',
              '- å˜ä¸€ Issue ã«è¤‡æ•°è¨€èªã‚’å«ã‚€',
              '- ã‚¦ã‚©ãƒƒãƒãƒ£ãƒ¼ã«é€šçŸ¥ã¯1ã¤ã®ã¿é€ä¿¡',
              '- Markdown ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒæ­£ã—ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°',
              '',
              `ğŸŒŸ ${bold}ãƒ†ã‚¹ãƒˆãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸï¼${bold} ğŸŒŸ`,
              '',
              '</details>',
              '',
              '---',
              '',
              `${bold}Test by GitHub Actions${bold} - [View Workflow Run](${runUrl})`
            ].join('\n');

            // Create single multi-language test issue
            console.log('Creating multi-language test issue...');
            const issue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: '[TEST] ğŸ„ SantaCode Exchange Completed! | äº¤æ›å®Œæˆï¼ | äº¤æ›å®Œäº†ï¼ğŸ',
              body: issueBody,
              labels: ['test', 'multi-language']
            });

            console.log(`âœ… Multi-language test issue created: Issue #${issue.data.number}`);
